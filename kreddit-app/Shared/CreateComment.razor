@using kreddit_app.Data;
@inject ApiService apiService

<div>
    <br/>
    <h3>Write a comment</h3>
    <input placeholder="Dit bruger-id" type="number" id="userId" @bind-value="userId"/>
    <input placeholder="Content" type="input" id="content" @bind-value="content"/>
    <button id="createPostButton" type="button" @onclick="CreateNewComment">Post comment</button>
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <p style="color:red">@errorMessage</p>
    }
</div>

@code {

    // PostId is passed in from the parent component. See how in PostItem.razor.
    [Parameter]
    public int PostId { get; set; }
    [Parameter]
    public EventCallback OnCommentCreated { get; set; }
    private int? userId;
    private string? content;
    private async void CreateNewComment()
    {
        if (userId is null || userId <= 0)
        {
            errorMessage = "Angiv et gyldigt bruger-id.";
            return;
        }
        if (string.IsNullOrWhiteSpace(content))
        {
            errorMessage = "Skriv en kommentar.";
            return;
        }
        errorMessage = null;
        await apiService.CreateComment(content, PostId, userId.Value);
        userId = null;
        content = "";

        if (OnCommentCreated.HasDelegate)
        {
            await OnCommentCreated.InvokeAsync();
        }
    }
    private string? errorMessage;
}
